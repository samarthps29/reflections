import{r as m}from"./react-4fd50329.js";import{f as w,i as te,j as D,d as k,b as Z,c as ee,h as ce,g as be,k as Te,l as Ie,a as fe,m as Le,_ as ve,e as Y}from"./@babel-c1091338.js";import{a as j,q as J,z as H,A as _,B as Ae}from"./rc-util-314658b4.js";import{S as xe}from"./async-validator-dee29e8b.js";var K="RC_FORM_INTERNAL_HOOKS",$=function(){j(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},G=m.createContext({getFieldValue:$,getFieldsValue:$,getFieldError:$,getFieldWarning:$,getFieldsError:$,isFieldsTouched:$,isFieldTouched:$,isFieldValidating:$,isFieldsValidating:$,resetFields:$,setFields:$,setFieldValue:$,setFieldsValue:$,validateFields:$,submit:$,getInternalHooks:function(){return $(),{dispatch:$,initEntityValue:$,registerField:$,useSubscribe:$,setInitialValues:$,destroyForm:$,setCallbacks:$,registerWatch:$,getFields:$,setValidateMessages:$,setPreserve:$,getInitialValue:$}}}),ie=m.createContext(null);function ae(o){return o==null?[]:Array.isArray(o)?o:[o]}function Ue(o){return o&&!!o._init}var A="'${name}' is not a valid ${type}",ke={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:A,method:A,array:A,object:A,number:A,date:A,boolean:A,integer:A,float:A,regexp:A,email:A,url:A,hex:A},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}},ye=xe;function We(o,u){return o.replace(/\$\{\w+\}/g,function(t){var r=t.slice(2,-1);return u[r]})}var Ve="CODE_LOGIC_ERROR";function se(o,u,t,r,e){return ue.apply(this,arguments)}function ue(){return ue=te(D().mark(function o(u,t,r,e,n){var a,d,i,s,l,c,f,y,F;return D().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return a=w({},r),delete a.ruleIndex,ye.warning=function(){},a.validator&&(d=a.validator,a.validator=function(){try{return d.apply(void 0,arguments)}catch(h){return console.error(h),Promise.reject(Ve)}}),i=null,a&&a.type==="array"&&a.defaultField&&(i=a.defaultField,delete a.defaultField),s=new ye(Z({},u,[a])),l=J(ke,e.validateMessages),s.messages(l),c=[],v.prev=10,v.next=13,Promise.resolve(s.validate(Z({},u,t),w({},e)));case 13:v.next=18;break;case 15:v.prev=15,v.t0=v.catch(10),v.t0.errors&&(c=v.t0.errors.map(function(h,g){var V=h.message,C=V===Ve?l.default:V;return m.isValidElement(C)?m.cloneElement(C,{key:"error_".concat(g)}):C}));case 18:if(!(!c.length&&i)){v.next=23;break}return v.next=21,Promise.all(t.map(function(h,g){return se("".concat(u,".").concat(g),h,i,e,n)}));case 21:return f=v.sent,v.abrupt("return",f.reduce(function(h,g){return[].concat(k(h),k(g))},[]));case 23:return y=w(w({},r),{},{name:u,enum:(r.enum||[]).join(", ")},n),F=c.map(function(h){return typeof h=="string"?We(h,y):h}),v.abrupt("return",F);case 26:case"end":return v.stop()}},o,null,[[10,15]])})),ue.apply(this,arguments)}function _e(o,u,t,r,e,n){var a=o.join("."),d=t.map(function(l,c){var f=l.validator,y=w(w({},l),{},{ruleIndex:c});return f&&(y.validator=function(F,p,v){var h=!1,g=function(){for(var N=arguments.length,P=new Array(N),R=0;R<N;R++)P[R]=arguments[R];Promise.resolve().then(function(){j(!h,"Your validator function has already return a promise. `callback` will be ignored."),h||v.apply(void 0,P)})},V=f(F,p,g);h=V&&typeof V.then=="function"&&typeof V.catch=="function",j(h,"`callback` is deprecated. Please return a promise instead."),h&&V.then(function(){v()}).catch(function(C){v(C||" ")})}),y}).sort(function(l,c){var f=l.warningOnly,y=l.ruleIndex,F=c.warningOnly,p=c.ruleIndex;return!!f==!!F?y-p:f?1:-1}),i;if(e===!0)i=new Promise(function(){var l=te(D().mark(function c(f,y){var F,p,v;return D().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:F=0;case 1:if(!(F<d.length)){g.next=12;break}return p=d[F],g.next=5,se(a,u,p,r,n);case 5:if(v=g.sent,!v.length){g.next=9;break}return y([{errors:v,rule:p}]),g.abrupt("return");case 9:F+=1,g.next=1;break;case 12:f([]);case 13:case"end":return g.stop()}},c)}));return function(c,f){return l.apply(this,arguments)}}());else{var s=d.map(function(l){return se(a,u,l,r,n).then(function(c){return{errors:c,rule:l}})});i=(e?je(s):He(s)).then(function(l){return Promise.reject(l)})}return i.catch(function(l){return l}),i}function He(o){return le.apply(this,arguments)}function le(){return le=te(D().mark(function o(u){return D().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Promise.all(u).then(function(e){var n,a=(n=[]).concat.apply(n,k(e));return a}));case 1:case"end":return r.stop()}},o)})),le.apply(this,arguments)}function je(o){return oe.apply(this,arguments)}function oe(){return oe=te(D().mark(function o(u){var t;return D().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0,e.abrupt("return",new Promise(function(n){u.forEach(function(a){a.then(function(d){d.errors.length&&n([d]),t+=1,t===u.length&&n([])})})}));case 2:case"end":return e.stop()}},o)})),oe.apply(this,arguments)}function O(o){return ae(o)}function Pe(o,u){var t={};return u.forEach(function(r){var e=H(o,r);t=_(t,r,e)}),t}function B(o,u){return o&&o.some(function(t){return Re(t,u)})}function Re(o,u){return!o||!u||o.length!==u.length?!1:o.every(function(t,r){return u[r]===t})}function De(o,u){if(o===u)return!0;if(!o&&u||o&&!u||!o||!u||ee(o)!=="object"||ee(u)!=="object")return!1;var t=Object.keys(o),r=Object.keys(u),e=new Set([].concat(t,r));return k(e).every(function(n){var a=o[n],d=u[n];return typeof a=="function"&&typeof d=="function"?!0:a===d})}function ze(o){var u=arguments.length<=1?void 0:arguments[1];return u&&u.target&&ee(u.target)==="object"&&o in u.target?u.target[o]:u}function Ce(o,u,t){var r=o.length;if(u<0||u>=r||t<0||t>=r)return o;var e=o[u],n=u-t;return n>0?[].concat(k(o.slice(0,t)),[e],k(o.slice(t,u)),k(o.slice(u+1,r))):n<0?[].concat(k(o.slice(0,u)),k(o.slice(u+1,t+1)),[e],k(o.slice(t+1,r))):o}var Ke=["name"],x=[];function Ee(o,u,t,r,e,n){return typeof o=="function"?o(u,t,"source"in n?{source:n.source}:{}):r!==e}var ge=function(o){Te(t,o);var u=Ie(t);function t(r){var e;if(fe(this,t),e=u.call(this,r),e.state={resetCount:0},e.cancelRegisterFunc=null,e.mounted=!1,e.touched=!1,e.dirty=!1,e.validatePromise=void 0,e.prevValidating=void 0,e.errors=x,e.warnings=x,e.cancelRegister=function(){var i=e.props,s=i.preserve,l=i.isListField,c=i.name;e.cancelRegisterFunc&&e.cancelRegisterFunc(l,s,O(c)),e.cancelRegisterFunc=null},e.getNamePath=function(){var i=e.props,s=i.name,l=i.fieldContext,c=l.prefixName,f=c===void 0?[]:c;return s!==void 0?[].concat(k(f),k(s)):[]},e.getRules=function(){var i=e.props,s=i.rules,l=s===void 0?[]:s,c=i.fieldContext;return l.map(function(f){return typeof f=="function"?f(c):f})},e.refresh=function(){e.mounted&&e.setState(function(i){var s=i.resetCount;return{resetCount:s+1}})},e.triggerMetaEvent=function(i){var s=e.props.onMetaChange;s==null||s(w(w({},e.getMeta()),{},{destroy:i}))},e.onStoreChange=function(i,s,l){var c=e.props,f=c.shouldUpdate,y=c.dependencies,F=y===void 0?[]:y,p=c.onReset,v=l.store,h=e.getNamePath(),g=e.getValue(i),V=e.getValue(v),C=s&&B(s,h);switch(l.type==="valueUpdate"&&l.source==="external"&&g!==V&&(e.touched=!0,e.dirty=!0,e.validatePromise=null,e.errors=x,e.warnings=x,e.triggerMetaEvent()),l.type){case"reset":if(!s||C){e.touched=!1,e.dirty=!1,e.validatePromise=void 0,e.errors=x,e.warnings=x,e.triggerMetaEvent(),p==null||p(),e.refresh();return}break;case"remove":{if(f){e.reRender();return}break}case"setField":{if(C){var N=l.data;"touched"in N&&(e.touched=N.touched),"validating"in N&&!("originRCField"in N)&&(e.validatePromise=N.validating?Promise.resolve([]):null),"errors"in N&&(e.errors=N.errors||x),"warnings"in N&&(e.warnings=N.warnings||x),e.dirty=!0,e.triggerMetaEvent(),e.reRender();return}if(f&&!h.length&&Ee(f,i,v,g,V,l)){e.reRender();return}break}case"dependenciesUpdate":{var P=F.map(O);if(P.some(function(R){return B(l.relatedFields,R)})){e.reRender();return}break}default:if(C||(!F.length||h.length||f)&&Ee(f,i,v,g,V,l)){e.reRender();return}break}f===!0&&e.reRender()},e.validateRules=function(i){var s=e.getNamePath(),l=e.getValue(),c=i||{},f=c.triggerName,y=c.validateOnly,F=y===void 0?!1:y,p=Promise.resolve().then(function(){if(!e.mounted)return[];var v=e.props,h=v.validateFirst,g=h===void 0?!1:h,V=v.messageVariables,C=e.getRules();f&&(C=C.filter(function(P){return P}).filter(function(P){var R=P.validateTrigger;if(!R)return!0;var S=ae(R);return S.includes(f)}));var N=_e(s,l,C,i,g,V);return N.catch(function(P){return P}).then(function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:x;if(e.validatePromise===p){var R;e.validatePromise=null;var S=[],T=[];(R=P.forEach)===null||R===void 0||R.call(P,function(b){var M=b.rule.warningOnly,E=b.errors,I=E===void 0?x:E;M?T.push.apply(T,k(I)):S.push.apply(S,k(I))}),e.errors=S,e.warnings=T,e.triggerMetaEvent(),e.reRender()}}),N});return F||(e.validatePromise=p,e.dirty=!0,e.errors=x,e.warnings=x,e.triggerMetaEvent(),e.reRender()),p},e.isFieldValidating=function(){return!!e.validatePromise},e.isFieldTouched=function(){return e.touched},e.isFieldDirty=function(){if(e.dirty||e.props.initialValue!==void 0)return!0;var i=e.props.fieldContext,s=i.getInternalHooks(K),l=s.getInitialValue;return l(e.getNamePath())!==void 0},e.getErrors=function(){return e.errors},e.getWarnings=function(){return e.warnings},e.isListField=function(){return e.props.isListField},e.isList=function(){return e.props.isList},e.isPreserve=function(){return e.props.preserve},e.getMeta=function(){e.prevValidating=e.isFieldValidating();var i={touched:e.isFieldTouched(),validating:e.prevValidating,errors:e.errors,warnings:e.warnings,name:e.getNamePath(),validated:e.validatePromise===null};return i},e.getOnlyChild=function(i){if(typeof i=="function"){var s=e.getMeta();return w(w({},e.getOnlyChild(i(e.getControlled(),s,e.props.fieldContext))),{},{isFunction:!0})}var l=Ae(i);return l.length!==1||!m.isValidElement(l[0])?{child:l,isFunction:!1}:{child:l[0],isFunction:!1}},e.getValue=function(i){var s=e.props.fieldContext.getFieldsValue,l=e.getNamePath();return H(i||s(!0),l)},e.getControlled=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=e.props,l=s.trigger,c=s.validateTrigger,f=s.getValueFromEvent,y=s.normalize,F=s.valuePropName,p=s.getValueProps,v=s.fieldContext,h=c!==void 0?c:v.validateTrigger,g=e.getNamePath(),V=v.getInternalHooks,C=v.getFieldsValue,N=V(K),P=N.dispatch,R=e.getValue(),S=p||function(E){return Z({},F,E)},T=i[l],b=w(w({},i),S(R));b[l]=function(){e.touched=!0,e.dirty=!0,e.triggerMetaEvent();for(var E,I=arguments.length,L=new Array(I),W=0;W<I;W++)L[W]=arguments[W];f?E=f.apply(void 0,L):E=ze.apply(void 0,[F].concat(L)),y&&(E=y(E,R,C(!0))),P({type:"updateValue",namePath:g,value:E}),T&&T.apply(void 0,L)};var M=ae(h||[]);return M.forEach(function(E){var I=b[E];b[E]=function(){I&&I.apply(void 0,arguments);var L=e.props.rules;L&&L.length&&P({type:"validateField",namePath:g,triggerName:E})}}),b},r.fieldContext){var n=r.fieldContext.getInternalHooks,a=n(K),d=a.initEntityValue;d(Le(e))}return e}return ve(t,[{key:"componentDidMount",value:function(){var e=this.props,n=e.shouldUpdate,a=e.fieldContext;if(this.mounted=!0,a){var d=a.getInternalHooks,i=d(K),s=i.registerField;this.cancelRegisterFunc=s(this)}n===!0&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var e=this.state.resetCount,n=this.props.children,a=this.getOnlyChild(n),d=a.child,i=a.isFunction,s;return i?s=d:m.isValidElement(d)?s=m.cloneElement(d,this.getControlled(d.props)):(j(!d,"`children` of Field is not validate ReactElement."),s=d),m.createElement(m.Fragment,{key:e},s)}}]),t}(m.Component);ge.contextType=G;ge.defaultProps={trigger:"onChange",valuePropName:"value"};function $e(o){var u=o.name,t=ce(o,Ke),r=m.useContext(G),e=m.useContext(ie),n=u!==void 0?O(u):void 0,a="keep";return t.isListField||(a="_".concat((n||[]).join("_"))),m.createElement(ge,be({key:a,name:n,isListField:!!e},t,{fieldContext:r}))}var qe=function(u){var t=u.name,r=u.initialValue,e=u.children,n=u.rules,a=u.validateTrigger,d=u.isListField,i=m.useContext(G),s=m.useContext(ie),l=m.useRef({keys:[],id:0}),c=l.current,f=m.useMemo(function(){var v=O(i.prefixName)||[];return[].concat(k(v),k(O(t)))},[i.prefixName,t]),y=m.useMemo(function(){return w(w({},i),{},{prefixName:f})},[i,f]),F=m.useMemo(function(){return{getKey:function(h){var g=f.length,V=h[g];return[c.keys[V],h.slice(g+1)]}}},[f]);if(typeof e!="function")return j(!1,"Form.List only accepts function as children."),null;var p=function(h,g,V){var C=V.source;return C==="internal"?!1:h!==g};return m.createElement(ie.Provider,{value:F},m.createElement(G.Provider,{value:y},m.createElement($e,{name:[],shouldUpdate:p,rules:n,validateTrigger:a,initialValue:r,isList:!0,isListField:d??!!s},function(v,h){var g=v.value,V=g===void 0?[]:g,C=v.onChange,N=i.getFieldValue,P=function(){var b=N(f||[]);return b||[]},R={add:function(b,M){var E=P();M>=0&&M<=E.length?(c.keys=[].concat(k(c.keys.slice(0,M)),[c.id],k(c.keys.slice(M))),C([].concat(k(E.slice(0,M)),[b],k(E.slice(M))))):(c.keys=[].concat(k(c.keys),[c.id]),C([].concat(k(E),[b]))),c.id+=1},remove:function(b){var M=P(),E=new Set(Array.isArray(b)?b:[b]);E.size<=0||(c.keys=c.keys.filter(function(I,L){return!E.has(L)}),C(M.filter(function(I,L){return!E.has(L)})))},move:function(b,M){if(b!==M){var E=P();b<0||b>=E.length||M<0||M>=E.length||(c.keys=Ce(c.keys,b,M),C(Ce(E,b,M)))}}},S=V||[];return Array.isArray(S)||(S=[]),e(S.map(function(T,b){var M=c.keys[b];return M===void 0&&(c.keys[b]=c.id,M=c.keys[b],c.id+=1),{name:b,key:M,isListField:!0}}),R,h)})))};function Ge(o){var u=!1,t=o.length,r=[];return o.length?new Promise(function(e,n){o.forEach(function(a,d){a.catch(function(i){return u=!0,i}).then(function(i){t-=1,r[d]=i,!(t>0)&&(u&&n(r),e(r))})})}):Promise.resolve([])}var Ne="__@field_split__";function ne(o){return o.map(function(u){return"".concat(ee(u),":").concat(u)}).join(Ne)}var q=function(){function o(){fe(this,o),this.kvs=new Map}return ve(o,[{key:"set",value:function(t,r){this.kvs.set(ne(t),r)}},{key:"get",value:function(t){return this.kvs.get(ne(t))}},{key:"update",value:function(t,r){var e=this.get(t),n=r(e);n?this.set(t,n):this.delete(t)}},{key:"delete",value:function(t){this.kvs.delete(ne(t))}},{key:"map",value:function(t){return k(this.kvs.entries()).map(function(r){var e=Y(r,2),n=e[0],a=e[1],d=n.split(Ne);return t({key:d.map(function(i){var s=i.match(/^([^:]*):(.*)$/),l=Y(s,3),c=l[1],f=l[2];return c==="number"?Number(f):f}),value:a})})}},{key:"toJSON",value:function(){var t={};return this.map(function(r){var e=r.key,n=r.value;return t[e.join(".")]=n,null}),t}}]),o}(),Je=["name"],Be=ve(function o(u){var t=this;fe(this,o),this.formHooked=!1,this.forceRootUpdate=void 0,this.subscribable=!0,this.store={},this.fieldEntities=[],this.initialValues={},this.callbacks={},this.validateMessages=null,this.preserve=null,this.lastValidatePromise=null,this.getForm=function(){return{getFieldValue:t.getFieldValue,getFieldsValue:t.getFieldsValue,getFieldError:t.getFieldError,getFieldWarning:t.getFieldWarning,getFieldsError:t.getFieldsError,isFieldsTouched:t.isFieldsTouched,isFieldTouched:t.isFieldTouched,isFieldValidating:t.isFieldValidating,isFieldsValidating:t.isFieldsValidating,resetFields:t.resetFields,setFields:t.setFields,setFieldValue:t.setFieldValue,setFieldsValue:t.setFieldsValue,validateFields:t.validateFields,submit:t.submit,_init:!0,getInternalHooks:t.getInternalHooks}},this.getInternalHooks=function(r){return r===K?(t.formHooked=!0,{dispatch:t.dispatch,initEntityValue:t.initEntityValue,registerField:t.registerField,useSubscribe:t.useSubscribe,setInitialValues:t.setInitialValues,destroyForm:t.destroyForm,setCallbacks:t.setCallbacks,setValidateMessages:t.setValidateMessages,getFields:t.getFields,setPreserve:t.setPreserve,getInitialValue:t.getInitialValue,registerWatch:t.registerWatch}):(j(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)},this.useSubscribe=function(r){t.subscribable=r},this.prevWithoutPreserves=null,this.setInitialValues=function(r,e){if(t.initialValues=r||{},e){var n,a=J(r,t.store);(n=t.prevWithoutPreserves)===null||n===void 0||n.map(function(d){var i=d.key;a=_(a,i,H(r,i))}),t.prevWithoutPreserves=null,t.updateStore(a)}},this.destroyForm=function(){var r=new q;t.getFieldEntities(!0).forEach(function(e){t.isMergedPreserve(e.isPreserve())||r.set(e.getNamePath(),!0)}),t.prevWithoutPreserves=r},this.getInitialValue=function(r){var e=H(t.initialValues,r);return r.length?J(e):e},this.setCallbacks=function(r){t.callbacks=r},this.setValidateMessages=function(r){t.validateMessages=r},this.setPreserve=function(r){t.preserve=r},this.watchList=[],this.registerWatch=function(r){return t.watchList.push(r),function(){t.watchList=t.watchList.filter(function(e){return e!==r})}},this.notifyWatch=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(t.watchList.length){var e=t.getFieldsValue(),n=t.getFieldsValue(!0);t.watchList.forEach(function(a){a(e,n,r)})}},this.timeoutId=null,this.warningUnhooked=function(){},this.updateStore=function(r){t.store=r},this.getFieldEntities=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return r?t.fieldEntities.filter(function(e){return e.getNamePath().length}):t.fieldEntities},this.getFieldsMap=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=new q;return t.getFieldEntities(r).forEach(function(n){var a=n.getNamePath();e.set(a,n)}),e},this.getFieldEntitiesForNamePathList=function(r){if(!r)return t.getFieldEntities(!0);var e=t.getFieldsMap(!0);return r.map(function(n){var a=O(n);return e.get(a)||{INVALIDATE_NAME_PATH:O(n)}})},this.getFieldsValue=function(r,e){if(t.warningUnhooked(),r===!0&&!e)return t.store;var n=t.getFieldEntitiesForNamePathList(Array.isArray(r)?r:null),a=[];return n.forEach(function(d){var i,s="INVALIDATE_NAME_PATH"in d?d.INVALIDATE_NAME_PATH:d.getNamePath();if(!(!r&&(!((i=d.isListField)===null||i===void 0)&&i.call(d))))if(!e)a.push(s);else{var l="getMeta"in d?d.getMeta():null;e(l)&&a.push(s)}}),Pe(t.store,a.map(O))},this.getFieldValue=function(r){t.warningUnhooked();var e=O(r);return H(t.store,e)},this.getFieldsError=function(r){t.warningUnhooked();var e=t.getFieldEntitiesForNamePathList(r);return e.map(function(n,a){return n&&!("INVALIDATE_NAME_PATH"in n)?{name:n.getNamePath(),errors:n.getErrors(),warnings:n.getWarnings()}:{name:O(r[a]),errors:[],warnings:[]}})},this.getFieldError=function(r){t.warningUnhooked();var e=O(r),n=t.getFieldsError([e])[0];return n.errors},this.getFieldWarning=function(r){t.warningUnhooked();var e=O(r),n=t.getFieldsError([e])[0];return n.warnings},this.isFieldsTouched=function(){t.warningUnhooked();for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];var a=e[0],d=e[1],i,s=!1;e.length===0?i=null:e.length===1?Array.isArray(a)?(i=a.map(O),s=!1):(i=null,s=a):(i=a.map(O),s=d);var l=t.getFieldEntities(!0),c=function(v){return v.isFieldTouched()};if(!i)return s?l.every(c):l.some(c);var f=new q;i.forEach(function(p){f.set(p,[])}),l.forEach(function(p){var v=p.getNamePath();i.forEach(function(h){h.every(function(g,V){return v[V]===g})&&f.update(h,function(g){return[].concat(k(g),[p])})})});var y=function(v){return v.some(c)},F=f.map(function(p){var v=p.value;return v});return s?F.every(y):F.some(y)},this.isFieldTouched=function(r){return t.warningUnhooked(),t.isFieldsTouched([r])},this.isFieldsValidating=function(r){t.warningUnhooked();var e=t.getFieldEntities();if(!r)return e.some(function(a){return a.isFieldValidating()});var n=r.map(O);return e.some(function(a){var d=a.getNamePath();return B(n,d)&&a.isFieldValidating()})},this.isFieldValidating=function(r){return t.warningUnhooked(),t.isFieldsValidating([r])},this.resetWithFieldInitialValue=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=new q,n=t.getFieldEntities(!0);n.forEach(function(i){var s=i.props.initialValue,l=i.getNamePath();if(s!==void 0){var c=e.get(l)||new Set;c.add({entity:i,value:s}),e.set(l,c)}});var a=function(s){s.forEach(function(l){var c=l.props.initialValue;if(c!==void 0){var f=l.getNamePath(),y=t.getInitialValue(f);if(y!==void 0)j(!1,"Form already set 'initialValues' with path '".concat(f.join("."),"'. Field can not overwrite it."));else{var F=e.get(f);if(F&&F.size>1)j(!1,"Multiple Field with path '".concat(f.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(F){var p=t.getFieldValue(f);(!r.skipExist||p===void 0)&&t.updateStore(_(t.store,f,k(F)[0].value))}}}})},d;r.entities?d=r.entities:r.namePathList?(d=[],r.namePathList.forEach(function(i){var s=e.get(i);if(s){var l;(l=d).push.apply(l,k(k(s).map(function(c){return c.entity})))}})):d=n,a(d)},this.resetFields=function(r){t.warningUnhooked();var e=t.store;if(!r){t.updateStore(J(t.initialValues)),t.resetWithFieldInitialValue(),t.notifyObservers(e,null,{type:"reset"}),t.notifyWatch();return}var n=r.map(O);n.forEach(function(a){var d=t.getInitialValue(a);t.updateStore(_(t.store,a,d))}),t.resetWithFieldInitialValue({namePathList:n}),t.notifyObservers(e,n,{type:"reset"}),t.notifyWatch(n)},this.setFields=function(r){t.warningUnhooked();var e=t.store,n=[];r.forEach(function(a){var d=a.name,i=ce(a,Je),s=O(d);n.push(s),"value"in i&&t.updateStore(_(t.store,s,i.value)),t.notifyObservers(e,[s],{type:"setField",data:a})}),t.notifyWatch(n)},this.getFields=function(){var r=t.getFieldEntities(!0),e=r.map(function(n){var a=n.getNamePath(),d=n.getMeta(),i=w(w({},d),{},{name:a,value:t.getFieldValue(a)});return Object.defineProperty(i,"originRCField",{value:!0}),i});return e},this.initEntityValue=function(r){var e=r.props.initialValue;if(e!==void 0){var n=r.getNamePath(),a=H(t.store,n);a===void 0&&t.updateStore(_(t.store,n,e))}},this.isMergedPreserve=function(r){var e=r!==void 0?r:t.preserve;return e??!0},this.registerField=function(r){t.fieldEntities.push(r);var e=r.getNamePath();if(t.notifyWatch([e]),r.props.initialValue!==void 0){var n=t.store;t.resetWithFieldInitialValue({entities:[r],skipExist:!0}),t.notifyObservers(n,[r.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(a,d){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(t.fieldEntities=t.fieldEntities.filter(function(c){return c!==r}),!t.isMergedPreserve(d)&&(!a||i.length>1)){var s=a?void 0:t.getInitialValue(e);if(e.length&&t.getFieldValue(e)!==s&&t.fieldEntities.every(function(c){return!Re(c.getNamePath(),e)})){var l=t.store;t.updateStore(_(l,e,s,!0)),t.notifyObservers(l,[e],{type:"remove"}),t.triggerDependenciesUpdate(l,e)}}t.notifyWatch([e])}},this.dispatch=function(r){switch(r.type){case"updateValue":{var e=r.namePath,n=r.value;t.updateValue(e,n);break}case"validateField":{var a=r.namePath,d=r.triggerName;t.validateFields([a],{triggerName:d});break}}},this.notifyObservers=function(r,e,n){if(t.subscribable){var a=w(w({},n),{},{store:t.getFieldsValue(!0)});t.getFieldEntities().forEach(function(d){var i=d.onStoreChange;i(r,e,a)})}else t.forceRootUpdate()},this.triggerDependenciesUpdate=function(r,e){var n=t.getDependencyChildrenFields(e);return n.length&&t.validateFields(n),t.notifyObservers(r,n,{type:"dependenciesUpdate",relatedFields:[e].concat(k(n))}),n},this.updateValue=function(r,e){var n=O(r),a=t.store;t.updateStore(_(t.store,n,e)),t.notifyObservers(a,[n],{type:"valueUpdate",source:"internal"}),t.notifyWatch([n]);var d=t.triggerDependenciesUpdate(a,n),i=t.callbacks.onValuesChange;if(i){var s=Pe(t.store,[n]);i(s,t.getFieldsValue())}t.triggerOnFieldsChange([n].concat(k(d)))},this.setFieldsValue=function(r){t.warningUnhooked();var e=t.store;if(r){var n=J(t.store,r);t.updateStore(n)}t.notifyObservers(e,null,{type:"valueUpdate",source:"external"}),t.notifyWatch()},this.setFieldValue=function(r,e){t.setFields([{name:r,value:e}])},this.getDependencyChildrenFields=function(r){var e=new Set,n=[],a=new q;t.getFieldEntities().forEach(function(i){var s=i.props.dependencies;(s||[]).forEach(function(l){var c=O(l);a.update(c,function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Set;return f.add(i),f})})});var d=function i(s){var l=a.get(s)||new Set;l.forEach(function(c){if(!e.has(c)){e.add(c);var f=c.getNamePath();c.isFieldDirty()&&f.length&&(n.push(f),i(f))}})};return d(r),n},this.triggerOnFieldsChange=function(r,e){var n=t.callbacks.onFieldsChange;if(n){var a=t.getFields();if(e){var d=new q;e.forEach(function(s){var l=s.name,c=s.errors;d.set(l,c)}),a.forEach(function(s){s.errors=d.get(s.name)||s.errors})}var i=a.filter(function(s){var l=s.name;return B(r,l)});n(i,a)}},this.validateFields=function(r,e){t.warningUnhooked();var n,a;Array.isArray(r)||typeof r=="string"||typeof e=="string"?(n=r,a=e):a=r;var d=!!n,i=d?n.map(O):[],s=[];t.getFieldEntities(!0).forEach(function(f){var y;if(d||i.push(f.getNamePath()),!((y=a)===null||y===void 0)&&y.recursive&&d){var F=f.getNamePath();F.every(function(h,g){return n[g]===h||n[g]===void 0})&&i.push(F)}if(!(!f.props.rules||!f.props.rules.length)){var p=f.getNamePath();if(!d||B(i,p)){var v=f.validateRules(w({validateMessages:w(w({},ke),t.validateMessages)},a));s.push(v.then(function(){return{name:p,errors:[],warnings:[]}}).catch(function(h){var g,V=[],C=[];return(g=h.forEach)===null||g===void 0||g.call(h,function(N){var P=N.rule.warningOnly,R=N.errors;P?C.push.apply(C,k(R)):V.push.apply(V,k(R))}),V.length?Promise.reject({name:p,errors:V,warnings:C}):{name:p,errors:V,warnings:C}}))}}});var l=Ge(s);t.lastValidatePromise=l,l.catch(function(f){return f}).then(function(f){var y=f.map(function(F){var p=F.name;return p});t.notifyObservers(t.store,y,{type:"validateFinish"}),t.triggerOnFieldsChange(y,f)});var c=l.then(function(){return t.lastValidatePromise===l?Promise.resolve(t.getFieldsValue(i)):Promise.reject([])}).catch(function(f){var y=f.filter(function(F){return F&&F.errors.length});return Promise.reject({values:t.getFieldsValue(i),errorFields:y,outOfDate:t.lastValidatePromise!==l})});return c.catch(function(f){return f}),t.triggerOnFieldsChange(i),c},this.submit=function(){t.warningUnhooked(),t.validateFields().then(function(r){var e=t.callbacks.onFinish;if(e)try{e(r)}catch(n){console.error(n)}}).catch(function(r){var e=t.callbacks.onFinishFailed;e&&e(r)})},this.forceRootUpdate=u});function Me(o){var u=m.useRef(),t=m.useState({}),r=Y(t,2),e=r[1];if(!u.current)if(o)u.current=o;else{var n=function(){e({})},a=new Be(n);u.current=a.getForm()}return[u.current]}var de=m.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),Ye=function(u){var t=u.validateMessages,r=u.onFormChange,e=u.onFormFinish,n=u.children,a=m.useContext(de),d=m.useRef({});return m.createElement(de.Provider,{value:w(w({},a),{},{validateMessages:w(w({},a.validateMessages),t),triggerFormChange:function(s,l){r&&r(s,{changedFields:l,forms:d.current}),a.triggerFormChange(s,l)},triggerFormFinish:function(s,l){e&&e(s,{values:l,forms:d.current}),a.triggerFormFinish(s,l)},registerForm:function(s,l){s&&(d.current=w(w({},d.current),{},Z({},s,l))),a.registerForm(s,l)},unregisterForm:function(s){var l=w({},d.current);delete l[s],d.current=l,a.unregisterForm(s)}})},n)},Qe=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed"],Xe=function(u,t){var r=u.name,e=u.initialValues,n=u.fields,a=u.form,d=u.preserve,i=u.children,s=u.component,l=s===void 0?"form":s,c=u.validateMessages,f=u.validateTrigger,y=f===void 0?"onChange":f,F=u.onValuesChange,p=u.onFieldsChange,v=u.onFinish,h=u.onFinishFailed,g=ce(u,Qe),V=m.useContext(de),C=Me(a),N=Y(C,1),P=N[0],R=P.getInternalHooks(K),S=R.useSubscribe,T=R.setInitialValues,b=R.setCallbacks,M=R.setValidateMessages,E=R.setPreserve,I=R.destroyForm;m.useImperativeHandle(t,function(){return P}),m.useEffect(function(){return V.registerForm(r,P),function(){V.unregisterForm(r)}},[V,P,r]),M(w(w({},V.validateMessages),c)),b({onValuesChange:F,onFieldsChange:function(U){if(V.triggerFormChange(r,U),p){for(var z=arguments.length,Fe=new Array(z>1?z-1:0),X=1;X<z;X++)Fe[X-1]=arguments[X];p.apply(void 0,[U].concat(Fe))}},onFinish:function(U){V.triggerFormFinish(r,U),v&&v(U)},onFinishFailed:h}),E(d);var L=m.useRef(null);T(e,!L.current),L.current||(L.current=!0),m.useEffect(function(){return I},[]);var W,he=typeof i=="function";if(he){var Oe=P.getFieldsValue(!0);W=i(Oe,P)}else W=i;S(!he);var me=m.useRef();m.useEffect(function(){De(me.current||[],n||[])||P.setFields(n||[]),me.current=n},[n,P]);var Se=m.useMemo(function(){return w(w({},P),{},{validateTrigger:y})},[P,y]),pe=m.createElement(G.Provider,{value:Se},W);return l===!1?pe:m.createElement(l,be({},g,{onSubmit:function(U){U.preventDefault(),U.stopPropagation(),P.submit()},onReset:function(U){var z;U.preventDefault(),P.resetFields(),(z=g.onReset)===null||z===void 0||z.call(g,U)}}),pe)};function we(o){try{return JSON.stringify(o)}catch{return Math.random()}}function Ze(){for(var o=arguments.length,u=new Array(o),t=0;t<o;t++)u[t]=arguments[t];var r=u[0],e=r===void 0?[]:r,n=u[1],a=n===void 0?{}:n,d=Ue(a)?{form:a}:a,i=d.form,s=m.useState(),l=Y(s,2),c=l[0],f=l[1],y=m.useMemo(function(){return we(c)},[c]),F=m.useRef(y);F.current=y;var p=m.useContext(G),v=i||p,h=v&&v._init,g=O(e),V=m.useRef(g);return V.current=g,m.useEffect(function(){if(h){var C=v.getFieldsValue,N=v.getInternalHooks,P=N(K),R=P.registerWatch,S=R(function(b,M){var E=H(d.preserve?M:b,V.current),I=we(E);F.current!==I&&(F.current=I,f(E))}),T=H(d.preserve?C(!0):C(),V.current);return f(T),S}},[h]),c}var et=m.forwardRef(Xe),Q=et;Q.FormProvider=Ye;Q.Field=$e;Q.List=qe;Q.useForm=Me;Q.useWatch=Ze;
